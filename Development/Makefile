# MacPortScanner Makefile
# Provides convenient commands for building, testing, and managing the project

.PHONY: all build clean test install run help setup deps

# Default target
all: build

# Build the entire project
build:
	@echo "ğŸš€ Building MacPortScanner..."
	@./build.sh

# Clean all build artifacts
clean:
	@echo "ğŸ§¹ Cleaning build artifacts..."
	@cd Core && cargo clean
	@cd UI && xcodebuild clean -project MacPortScanner.xcodeproj -scheme MacPortScanner || true
	@rm -rf dist/
	@echo "âœ… Clean completed"

# Run tests
test:
	@echo "ğŸ§ª Running tests..."
	@cd Core && cargo test --release
	@echo "âœ… Tests completed"

# Setup development environment
setup:
	@echo "ğŸ”§ Setting up development environment..."
	@./setup.sh

# Install dependencies
deps:
	@echo "ğŸ“¦ Installing dependencies..."
	@cd Core && cargo fetch
	@echo "âœ… Dependencies installed"

# Run the application (debug mode)
run-debug:
	@echo "ğŸƒ Running in debug mode..."
	@cd Core && cargo build
	@cd UI && xcodebuild build -project MacPortScanner.xcodeproj -scheme MacPortScanner -configuration Debug
	@open UI/build/Debug/MacPortScanner.app

# Run the application (release mode)
run:
	@echo "ğŸƒ Running application..."
	@if [ -d "dist/MacPortScanner.app" ]; then \
		open dist/MacPortScanner.app; \
	else \
		echo "âŒ Application not built. Run 'make build' first."; \
	fi

# Format code
format:
	@echo "ğŸ¨ Formatting code..."
	@cd Core && cargo fmt
	@echo "âœ… Code formatted"

# Lint code
lint:
	@echo "ğŸ” Linting code..."
	@cd Core && cargo clippy -- -D warnings
	@echo "âœ… Linting completed"

# Check code quality
check: format lint test

# Create release package
release: clean build
	@echo "ğŸ“¦ Creating release package..."
	@if [ -d "dist/MacPortScanner.app" ]; then \
		echo "âœ… Release package ready in dist/"; \
	else \
		echo "âŒ Release build failed"; \
		exit 1; \
	fi

# Install the application to /Applications
install: build
	@echo "ğŸ“² Installing MacPortScanner..."
	@if [ -d "dist/MacPortScanner.app" ]; then \
		cp -R dist/MacPortScanner.app /Applications/; \
		echo "âœ… MacPortScanner installed to /Applications/"; \
	else \
		echo "âŒ Application not found. Run 'make build' first."; \
		exit 1; \
	fi

# Uninstall the application
uninstall:
	@echo "ğŸ—‘ï¸  Uninstalling MacPortScanner..."
	@rm -rf /Applications/MacPortScanner.app
	@echo "âœ… MacPortScanner uninstalled"

# Generate documentation
docs:
	@echo "ğŸ“š Generating documentation..."
	@cd Core && cargo doc --no-deps --open
	@echo "âœ… Documentation generated"

# Benchmark performance
bench:
	@echo "âš¡ Running benchmarks..."
	@cd Core && cargo bench
	@echo "âœ… Benchmarks completed"

# Update dependencies
update:
	@echo "ğŸ”„ Updating dependencies..."
	@cd Core && cargo update
	@echo "âœ… Dependencies updated"

# Security audit
audit:
	@echo "ğŸ”’ Running security audit..."
	@cd Core && cargo audit
	@echo "âœ… Security audit completed"

# Development server (for UI development)
dev:
	@echo "ğŸ”§ Starting development environment..."
	@echo "Building Rust library in debug mode..."
	@cd Core && cargo build
	@echo "Starting Xcode for UI development..."
	@open UI/MacPortScanner.xcodeproj

# Show help
help:
	@echo "MacPortScanner Build System"
	@echo ""
	@echo "Available targets:"
	@echo "  build      - Build the entire project (default)"
	@echo "  clean      - Clean all build artifacts"
	@echo "  test       - Run all tests"
	@echo "  setup      - Setup development environment"
	@echo "  deps       - Install dependencies"
	@echo "  run        - Run the application (release mode)"
	@echo "  run-debug  - Run the application (debug mode)"
	@echo "  format     - Format Rust code"
	@echo "  lint       - Lint Rust code"
	@echo "  check      - Format, lint, and test"
	@echo "  release    - Create release package"
	@echo "  install    - Install to /Applications"
	@echo "  uninstall  - Remove from /Applications"
	@echo "  docs       - Generate documentation"
	@echo "  bench      - Run benchmarks"
	@echo "  update     - Update dependencies"
	@echo "  audit      - Run security audit"
	@echo "  dev        - Start development environment"
	@echo "  help       - Show this help message"
	@echo ""
	@echo "Examples:"
	@echo "  make build    # Build the project"
	@echo "  make test     # Run tests"
	@echo "  make install  # Build and install"
	@echo "  make clean    # Clean everything"