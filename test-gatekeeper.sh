#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—Ö–æ–¥–∞ Gatekeeper –Ω–∞ macOS
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./test-gatekeeper.sh /path/to/MacPortScanner.app

if [ $# -eq 0 ]; then
    echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $0 /path/to/MacPortScanner.app"
    exit 1
fi

APP_PATH="$1"

echo "üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Gatekeeper –¥–ª—è: $APP_PATH"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
if [ ! -d "$APP_PATH" ]; then
    echo "‚ùå –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ: $APP_PATH"
    exit 1
fi

echo "üìã –¢–µ–∫—É—â–∏–µ –∞—Ç—Ä–∏–±—É—Ç—ã –∫–∞—Ä–∞–Ω—Ç–∏–Ω–∞:"
xattr -d com.apple.quarantine "$APP_PATH" 2>/dev/null || echo "‚ÑπÔ∏è  –ö–∞—Ä–∞–Ω—Ç–∏–Ω –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–ª–∏ —É–∂–µ —É–¥–∞–ª–µ–Ω"

echo "üßπ –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤:"
xattr -cr "$APP_PATH"

echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–≤–æ–π–Ω—ã–º –∫–ª–∏–∫–æ–º."
echo ""
echo "–ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤—Å–µ –µ—â–µ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è:"
echo "1. –©–µ–ª–∫–Ω–∏—Ç–µ –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –ø–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é ‚Üí '–û—Ç–∫—Ä—ã—Ç—å'"
echo "2. –ò–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ '–°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏' ‚Üí '–ó–∞—â–∏—Ç–∞ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å' ‚Üí '–í—Å–µ —Ä–∞–≤–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å'"