# MacPortScanner Build Guide

–ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–±–æ—Ä–∫–µ MacPortScanner.

## üéØ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- macOS 14.0 –∏–ª–∏ –Ω–æ–≤–µ–µ
- Rust 1.70+ (—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å [rustup.rs](https://rustup.rs/))
- Xcode Command Line Tools: `xcode-select --install`

### –°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–±
```bash
git clone https://github.com/iwizard7/MacPortScanner.git
cd MacPortScanner
make quick && make run
```

## üõ†Ô∏è –í–∞—Ä–∏–∞–Ω—Ç—ã —Å–±–æ—Ä–∫–∏

### 1. –ë—ã—Å—Ç—Ä–∞—è —Å–±–æ—Ä–∫–∞ (`quick-build.sh`)
**–í—Ä–µ–º—è:** ~2-3 –º–∏–Ω—É—Ç—ã  
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ë—ã—Å—Ç—Ä—ã–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```bash
./quick-build.sh
# –∏–ª–∏
make quick
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –°–æ–±–∏—Ä–∞–µ—Ç Rust –±–∏–±–ª–∏–æ—Ç–µ–∫—É –≤ release —Ä–µ–∂–∏–º–µ
- –°–æ–∑–¥–∞–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π app bundle
- –í—ã–≤–æ–¥–∏—Ç: `dist-quick/MacPortScanner.app`

### 2. –ü–æ–ª–Ω–∞—è —Å–±–æ—Ä–∫–∞ (`build-local.sh`)
**–í—Ä–µ–º—è:** ~5-10 –º–∏–Ω—É—Ç  
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–±–æ—Ä–∫–∞

```bash
./build-local.sh
# –∏–ª–∏
make build
```

**–û–ø—Ü–∏–∏:**
```bash
./build-local.sh --help
./build-local.sh --debug          # Debug —Å–±–æ—Ä–∫–∞
./build-local.sh --skip-tests     # –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
./build-local.sh --clean          # –û—á–∏—Å—Ç–∏—Ç—å –ø–µ—Ä–µ–¥ —Å–±–æ—Ä–∫–æ–π
./build-local.sh --verbose        # –ü–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –°–æ–±–∏—Ä–∞–µ—Ç Rust –±–∏–±–ª–∏–æ—Ç–µ–∫—É
- –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç—ã
- –ü—ã—Ç–∞–µ—Ç—Å—è —Å–æ–±—Ä–∞—Ç—å Swift UI (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω Xcode)
- –°–æ–∑–¥–∞–µ—Ç –ø–æ–ª–Ω—ã–π app bundle —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π
- –í—ã–≤–æ–¥–∏—Ç: `dist/MacPortScanner.app`

### 3. –°–±–æ—Ä–∫–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (`dev-build.sh`)
**–í—Ä–µ–º—è:** ~3-5 –º–∏–Ω—É—Ç  
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –∫–∞—á–µ—Å—Ç–≤–∞

```bash
./dev-build.sh
# –∏–ª–∏
make dev
```

**–û–ø—Ü–∏–∏:**
```bash
./dev-build.sh --help
./dev-build.sh --no-tests      # –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
./dev-build.sh --no-clippy     # –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å clippy
./dev-build.sh --benchmarks    # –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–µ–Ω—á–º–∞—Ä–∫–∏
./dev-build.sh --docs          # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
./dev-build.sh --watch         # –†–µ–∂–∏–º –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∫–æ–¥ (`cargo fmt`)
- –°–æ–±–∏—Ä–∞–µ—Ç –≤ debug —Ä–µ–∂–∏–º–µ (–±—ã—Å—Ç—Ä–µ–µ)
- –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç—ã
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–¥ —Å clippy
- –°–æ–∑–¥–∞–µ—Ç development app bundle —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º –º–µ–Ω—é
- –í—ã–≤–æ–¥–∏—Ç: `dev-dist/MacPortScanner-Dev.app`

## üì¶ –°–æ–∑–¥–∞–Ω–∏–µ DMG

```bash
./create-dmg.sh
# –∏–ª–∏
make dmg
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π `create-dmg`: `brew install create-dmg`
- –°–æ–±—Ä–∞–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ `dist/`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `MacPortScanner-0.1.0.dmg`

## üéÆ Makefile –∫–æ–º–∞–Ω–¥—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
```bash
make quick         # –ë—ã—Å—Ç—Ä–∞—è —Å–±–æ—Ä–∫–∞
make build         # –ü–æ–ª–Ω–∞—è —Å–±–æ—Ä–∫–∞  
make dev           # –°–±–æ—Ä–∫–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
make clean         # –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–∞—á–µ—Å—Ç–≤–æ
```bash
make test          # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
make lint          # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å clippy
make format        # –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
make check         # format + lint + test
make bench         # –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–µ–Ω—á–º–∞—Ä–∫–∏
make audit         # –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```

### –ó–∞–ø—É—Å–∫
```bash
make run           # –°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
make run-dev       # –ó–∞–ø—É—Å—Ç–∏—Ç—å dev –≤–µ—Ä—Å–∏—é
```

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```bash
make docs          # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏ –æ—Ç–∫—Ä—ã—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
```

### –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ
```bash
make dmg           # –°–æ–∑–¥–∞—Ç—å DMG
make package       # –ü–æ–ª–Ω–∞—è —Å–±–æ—Ä–∫–∞ + DMG
make install       # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ /Applications
make uninstall     # –£–¥–∞–ª–∏—Ç—å –∏–∑ /Applications
```

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```bash
make watch         # –ù–∞–±–ª—é–¥–∞—Ç—å –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
make setup         # –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å—Ä–µ–¥—É —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
make update        # –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```

### –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
```bash
make help          # –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã
make status        # –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞
```

## üîß –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–±–æ—Ä–∫–∏

### –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
```
MacPortScanner/
‚îú‚îÄ‚îÄ dist-quick/           # –ë—ã—Å—Ç—Ä–∞—è —Å–±–æ—Ä–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ MacPortScanner.app
‚îú‚îÄ‚îÄ dist/                 # –ü–æ–ª–Ω–∞—è —Å–±–æ—Ä–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ MacPortScanner.app
‚îÇ   ‚îú‚îÄ‚îÄ README.txt
‚îÇ   ‚îî‚îÄ‚îÄ BUILD_INFO.txt
‚îú‚îÄ‚îÄ dev-dist/             # –°–±–æ—Ä–∫–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ MacPortScanner-Dev.app
‚îî‚îÄ‚îÄ *.dmg                 # DMG —Ñ–∞–π–ª—ã
```

### Rust –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã
```
Core/target/
‚îú‚îÄ‚îÄ debug/                # Debug —Å–±–æ—Ä–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ libmacportscan_core.a
‚îÇ   ‚îî‚îÄ‚îÄ libmacportscan_core.dylib
‚îî‚îÄ‚îÄ release/              # Release —Å–±–æ—Ä–∫–∞
    ‚îú‚îÄ‚îÄ libmacportscan_core.a
    ‚îî‚îÄ‚îÄ libmacportscan_core.dylib
```

## üö® –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### Rust –Ω–µ –Ω–∞–π–¥–µ–Ω
```bash
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source ~/.cargo/env
```

### Xcode Command Line Tools –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
```bash
xcode-select --install
```

### create-dmg –Ω–µ –Ω–∞–π–¥–µ–Ω
```bash
brew install create-dmg
```

### –û—à–∏–±–∫–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ Rust
```bash
# –û–±–Ω–æ–≤–∏—Ç—å Rust
rustup update

# –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à
cargo clean

# –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
rm Cargo.lock
cargo build
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞
```bash
# –°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º–∏
chmod +x *.sh

# –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ app bundle
chmod +x dist/MacPortScanner.app/Contents/MacOS/MacPortScanner
```

## ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–±–æ—Ä–∫–∏

### –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ Rust
```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ ~/.cargo/config.toml
[build]
jobs = 8  # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ CPU —è–¥–µ—Ä

[target.x86_64-apple-darwin]
rustflags = ["-C", "link-arg=-fuse-ld=lld"]
```

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å sccache
cargo install sccache
export RUSTC_WRAPPER=sccache
```

## üìä –ë–µ–Ω—á–º–∞—Ä–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–µ–Ω—á–º–∞—Ä–∫–∏
make bench

# –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
cargo install flamegraph
cargo flamegraph --bench benchmark_portscan
```

## üéØ Continuous Integration

–°–∏–º—É–ª—è—Ü–∏—è CI –ª–æ–∫–∞–ª—å–Ω–æ:
```bash
make ci  # clean + format + lint + test
```

## üìù –õ–æ–≥–∏ —Å–±–æ—Ä–∫–∏

–í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã —Å–æ–∑–¥–∞—é—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏:
- `BUILD_INFO.txt` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–±–æ—Ä–∫–µ
- –¶–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

---

**–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?** –°–æ–∑–¥–∞–π—Ç–µ [issue –Ω–∞ GitHub](https://github.com/iwizard7/MacPortScanner/issues)